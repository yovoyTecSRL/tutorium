<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üßÆ MathGenius IA - Experto en Matem√°ticas</title>
  <meta name="description" content="Experto en Matem√°ticas y Ciencias Exactas. √Ålgebra, c√°lculo, estad√≠stica, f√≠sica y qu√≠mica con explicaciones visuales interactivas.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 50%, #6d28d9 100%);
      color: #1a202c;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    .math-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: 
        radial-gradient(circle at 25% 25%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(124, 58, 237, 0.1) 0%, transparent 50%);
      animation: mathPulse 8s ease-in-out infinite;
    }
    
    @keyframes mathPulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }
    
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      position: relative;
      z-index: 1;
    }
    
    .header-section {
      background: linear-gradient(145deg, #ffffff 0%, #fafafa 100%);
      border-radius: 24px;
      padding: 40px;
      margin-bottom: 24px;
      box-shadow: 
        0 20px 25px -5px rgba(0, 0, 0, 0.1),
        0 10px 10px -5px rgba(0, 0, 0, 0.04);
      text-align: center;
      border: 1px solid rgba(139, 92, 246, 0.2);
      max-width: 800px;
      width: 100%;
      position: relative;
    }
    
    .status-indicator {
      position: absolute;
      top: 16px;
      right: 20px;
      background: #8b5cf6;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .math-avatar {
      width: 80px;
      height: 80px;
      border-radius: 16px;
      background: linear-gradient(145deg, #8b5cf6, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      font-size: 32px;
      color: white;
      box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
      transition: all 0.3s ease;
    }
    
    .math-avatar.listening {
      animation: listeningPulse 1s ease-in-out infinite;
      box-shadow: 0 10px 25px rgba(245, 158, 11, 0.5);
    }
    
    @keyframes listeningPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .main-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #1a202c;
      margin-bottom: 8px;
    }
    
    .subtitle {
      font-size: 1rem;
      color: #4a5568;
      margin-bottom: 16px;
      line-height: 1.5;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .specialties {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    
    .specialty-tag {
      background: #faf5ff;
      color: #6b21a8;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      border: 1px solid rgba(107, 33, 168, 0.2);
    }
    
    .specialty-tag.calculus { background: #ecfdf5; color: #065f46; border-color: rgba(6, 95, 70, 0.2); }
    .specialty-tag.physics { background: #eff6ff; color: #1e40af; border-color: rgba(30, 64, 175, 0.2); }
    
    .stats-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      width: 100%;
      max-width: 600px;
      margin-bottom: 24px;
    }
    
    .stat-card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      border: 1px solid #e2e8f0;
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: #8b5cf6;
      display: block;
    }
    
    .stat-label {
      font-size: 0.875rem;
      color: #4a5568;
      font-weight: 500;
    }
    
    .rating-display {
      color: #8b5cf6;
      font-weight: 600;
    }
    
    .conversation-area {
      background: white;
      border-radius: 24px;
      padding: 32px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 800px;
      margin-bottom: 24px;
      border: 1px solid #e2e8f0;
    }
    
    .conversation-controls {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    
    .control-button {
      background: #8b5cf6;
      border: none;
      color: white;
      padding: 12px 24px;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px -1px rgba(139, 92, 246, 0.3);
      min-width: 120px;
    }
    
    .control-button:hover {
      background: #7c3aed;
      transform: translateY(-1px);
      box-shadow: 0 6px 10px -1px rgba(139, 92, 246, 0.4);
    }
    
    .mic-button {
      background: #f59e0b;
      box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.3);
    }
    
    .mic-button:hover {
      background: #d97706;
      box-shadow: 0 6px 10px -1px rgba(245, 158, 11, 0.4);
    }
    
    .mic-button.recording {
      animation: recordingPulse 1s ease-in-out infinite;
    }
    
    @keyframes recordingPulse {
      0%, 100% { background: #f59e0b; }
      50% { background: #fbbf24; }
    }
    
    .solve-button {
      background: #10b981;
      box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.3);
    }
    
    .solve-button:hover {
      background: #059669;
      box-shadow: 0 6px 10px -1px rgba(16, 185, 129, 0.4);
    }
    
    .conversation-display {
      background: #f7fafc;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 24px;
      min-height: 300px;
      max-height: 500px;
      overflow-y: auto;
      margin-bottom: 20px;
    }
    
    .message {
      margin-bottom: 16px;
      padding: 16px 20px;
      border-radius: 16px;
      animation: messageSlide 0.3s ease-out;
      line-height: 1.6;
    }
    
    @keyframes messageSlide {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .user-message {
      background: #faf5ff;
      color: #1a202c;
      margin-left: 20px;
      border-left: 4px solid #8b5cf6;
    }
    
    .teacher-message {
      background: #f3e8ff;
      color: #1a202c;
      margin-right: 20px;
      border-left: 4px solid #7c3aed;
    }
    
    .formula-message {
      background: #1f2937;
      color: #a78bfa;
      margin-right: 20px;
      border-left: 4px solid #8b5cf6;
      font-family: 'Courier New', monospace;
      font-size: 16px;
      white-space: pre-wrap;
    }
    
    .input-area {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .message-input {
      flex: 1;
      padding: 16px 20px;
      border: 2px solid #e2e8f0;
      border-radius: 16px;
      font-size: 16px;
      outline: none;
      transition: border-color 0.3s ease;
      font-family: 'Inter', sans-serif;
    }
    
    .message-input:focus {
      border-color: #8b5cf6;
    }
    
    .send-button {
      background: #8b5cf6;
      border: none;
      color: white;
      padding: 16px 24px;
      border-radius: 16px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .send-button:hover {
      background: #7c3aed;
      transform: translateY(-1px);
    }
    
    .footer-info {
      text-align: center;
      color: rgba(255, 255, 255, 0.9);
      font-size: 14px;
      background: rgba(255, 255, 255, 0.1);
      padding: 16px 24px;
      border-radius: 16px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      max-width: 600px;
    }
    
    .status-bar {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid #8b5cf6;
      color: #1a202c;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      backdrop-filter: blur(10px);
      z-index: 1000;
    }
    
    @media (max-width: 768px) {
      .main-title { font-size: 2rem; }
      .conversation-controls { flex-direction: column; align-items: center; }
      .control-button { width: 200px; }
      .stats-section { grid-template-columns: 1fr; }
      .input-area { flex-direction: column; }
      .message-input { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="math-bg"></div>
  <div class="status-bar" id="status">üü¢ MathGenius Online</div>
  
  <div class="container">
    <div class="header-section">
      <div class="status-indicator">
        <div class="status-dot"></div>
        En L√≠nea
      </div>
      
      <div class="math-avatar" id="mathAvatar">üßÆ</div>
      
      <h1 class="main-title">MathGenius IA</h1>
      <p class="subtitle">Experto en Matem√°ticas y Ciencias Exactas<br>√Ålgebra, c√°lculo, estad√≠stica, f√≠sica y qu√≠mica con explicaciones visuales interactivas.</p>
      
      <div class="specialties">
        <span class="specialty-tag">√Ålgebra</span>
        <span class="specialty-tag calculus">C√°lculo</span>
        <span class="specialty-tag physics">F√≠sica</span>
        <span class="specialty-tag">Estad√≠stica</span>
      </div>
    </div>

    <div class="stats-section">
      <div class="stat-card">
        <span class="stat-number rating-display">4.9</span>
        <span class="stat-label">Rating</span>
      </div>
      <div class="stat-card">
        <span class="stat-number" id="problemsCount">3,240</span>
        <span class="stat-label">Problemas</span>
      </div>
      <div class="stat-card">
        <span class="stat-number">24/7</span>
        <span class="stat-label">Disponible</span>
      </div>
    </div>

    <div class="conversation-area">
      <div class="conversation-controls">
        <button onclick="connectTutor()" class="control-button" id="connectButton">üîó Conectar</button>
        <button onclick="toggleMicrophone()" class="control-button mic-button" id="micButton">üé§ Hablar</button>
        <button onclick="solveMode()" class="control-button solve-button">üìä Resolver</button>
        <button onclick="formulaMode()" class="control-button">üìê F√≥rmulas</button>
      </div>

      <div class="conversation-display" id="conversationDisplay">
        <div class="teacher-message">
          üßÆ ¬°Hola! Soy MathGenius IA, tu experto en matem√°ticas y ciencias exactas. Puedo ayudarte con √°lgebra, c√°lculo, estad√≠stica, f√≠sica, qu√≠mica y mucho m√°s. Explico paso a paso y proporciono visualizaciones interactivas. ¬øQu√© problema matem√°tico resolveremos hoy?
        </div>
      </div>

      <div class="input-area">
        <input type="text" class="message-input" id="messageInput" 
               placeholder="Escribe tu problema matem√°tico o ecuaci√≥n..." 
               onkeypress="handleKeyPress(event)">
        <button class="send-button" onclick="sendMessage()">üì§</button>
      </div>
    </div>

    <div class="footer-info">
      √Ålgebra, c√°lculo, estad√≠stica, f√≠sica y qu√≠mica con explicaciones visuales interactivas.
    </div>
  </div>

  <script>
    let isListening = false;
    let isConnected = false;
    let recognition;
    let audioContext;
    let problemsCount = 3240;

    function initAudio() {
      try {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      } catch (e) {
        console.warn('Audio context not supported');
      }
    }

    function playSound(frequency, duration, type = 'sine') {
      if (!audioContext) return;
      
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = frequency;
      oscillator.type = type;
      
      gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + duration);
    }

    function initSpeechRecognition() {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'es-ES';
        recognition.continuous = false;
        recognition.interimResults = false;
        
        recognition.onstart = function() {
          updateStatus('üé§ Escuchando matem√°ticas...');
          document.getElementById('mathAvatar').classList.add('listening');
          playSound(800, 0.3);
        };
        
        recognition.onresult = function(event) {
          const transcript = event.results[0][0].transcript;
          document.getElementById('messageInput').value = transcript;
          updateStatus('‚úÖ Calculando...');
          playSound(1000, 0.4, 'triangle');
          setTimeout(() => sendMessage(), 500);
        };
        
        recognition.onerror = function(event) {
          updateStatus('‚ùå Error de input');
          document.getElementById('mathAvatar').classList.remove('listening');
          playSound(400, 0.6, 'sawtooth');
        };
        
        recognition.onend = function() {
          isListening = false;
          document.getElementById('micButton').classList.remove('recording');
          document.getElementById('mathAvatar').classList.remove('listening');
          document.getElementById('micButton').innerHTML = 'üé§ Hablar';
          updateStatus(isConnected ? 'üü¢ Conectado' : 'üü¢ MathGenius Online');
        };
      }
    }

    function connectTutor() {
      isConnected = true;
      document.getElementById('connectButton').innerHTML = '‚úÖ Conectado';
      document.getElementById('connectButton').style.background = '#8b5cf6';
      updateStatus('üü¢ Conectado');
      problemsCount++;
      document.getElementById('problemsCount').textContent = problemsCount.toLocaleString();
      
      const greeting = "¬°Perfecto! Calculadora activada. Soy experto en todas las ramas de las matem√°ticas: √°lgebra, c√°lculo diferencial e integral, estad√≠stica, geometr√≠a, trigonometr√≠a, f√≠sica y qu√≠mica. Puedo resolver ecuaciones, explicar teoremas y crear visualizaciones. ¬øQu√© problema resolveremos?";
      
      addMessage(greeting, 'formula');
      speakMessage(greeting);
    }

    function toggleMicrophone() {
      if (!recognition) {
        initSpeechRecognition();
      }
      
      if (!isListening) {
        recognition.start();
        isListening = true;
        document.getElementById('micButton').classList.add('recording');
        document.getElementById('micButton').innerHTML = 'üõë Stop';
      } else {
        recognition.stop();
        isListening = false;
        document.getElementById('micButton').classList.remove('recording');
        document.getElementById('micButton').innerHTML = 'üé§ Hablar';
      }
    }

    function solveMode() {
      const message = "üìä MODO RESOLVER ACTIVADO\n‚à´ Resolutor de problemas matem√°ticos\n‚àë Paso a paso detallado\n‚àÄ Verificaci√≥n de resultados\n‚àÉ Explicaciones visuales\n\nf(x) = Introduce tu problema";
      addMessage(message, 'formula');
      speakMessage("Modo resolver activado. Env√≠a tu problema matem√°tico y lo resolver√© paso a paso con explicaciones detalladas.");
    }

    function formulaMode() {
      const message = "üìê BANCO DE F√ìRMULAS\n\n‚Ä¢ √Ålgebra: ax¬≤ + bx + c = 0\n‚Ä¢ C√°lculo: ‚à´f(x)dx, d/dx[f(x)]\n‚Ä¢ Trigonometr√≠a: sin¬≤Œ∏ + cos¬≤Œ∏ = 1\n‚Ä¢ F√≠sica: F = ma, E = mc¬≤\n‚Ä¢ Estad√≠stica: Œº = Œ£x/n\n\n¬øQu√© f√≥rmula necesitas?";
      addMessage(message, 'formula');
      speakMessage("Banco de f√≥rmulas activado. Tengo acceso a f√≥rmulas de √°lgebra, c√°lculo, trigonometr√≠a, f√≠sica y estad√≠stica. ¬øCu√°l necesitas?");
    }

    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        sendMessage();
      }
    }

    function addMessage(text, type) {
      const container = document.getElementById('conversationDisplay');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}-message`;
      messageDiv.textContent = text;
      container.appendChild(messageDiv);
      container.scrollTop = container.scrollHeight;
    }

    async function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      addMessage(message, 'user');
      input.value = '';
      
      updateStatus('üîÑ Calculando...');
      
      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer YOUR_OPENAI_API_KEY_HERE"
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [
              {
                role: "system",
                content: "Eres MathGenius IA, experto en matem√°ticas y ciencias exactas. Dominas √°lgebra, c√°lculo, estad√≠stica, geometr√≠a, trigonometr√≠a, f√≠sica y qu√≠mica. Resuelves problemas paso a paso, explicas conceptos claramente y proporcionas f√≥rmulas cuando es necesario. Eres did√°ctico y paciente, adaptando tu nivel al estudiante."
              },
              {
                role: "user",
                content: message
              }
            ]
          })
        });

        const data = await response.json();
        const reply = data.choices[0].message.content;
        
        // Determine message type based on content
        const messageType = reply.includes('=') || reply.includes('‚à´') || reply.includes('‚àë') || reply.includes('¬≤') || reply.includes('‚àö') ? 'formula' : 'teacher';
        addMessage(reply, messageType);
        speakMessage(reply);
        
        updateStatus(isConnected ? 'üü¢ Conectado' : 'üü¢ MathGenius Online');

      } catch (error) {
        console.error("Error:", error);
        addMessage("‚ùå ERROR MATEM√ÅTICO\nDivisi√≥n por cero en el servidor\nf(error) = conexi√≥n_perdida\nIntenta nuevamente...", 'formula');
        updateStatus('‚ùå Error');
      }
    }

    function speakMessage(text) {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'es-ES';
        utterance.rate = 0.85;
        utterance.pitch = 1.1;
        utterance.volume = 0.8;
        
        const voices = speechSynthesis.getVoices();
        const preferredVoice = voices.find(voice => 
          voice.lang.includes('es') && voice.name.includes('Female')
        ) || voices.find(voice => voice.lang.includes('es')) || voices[0];
        
        if (preferredVoice) {
          utterance.voice = preferredVoice;
        }
        
        speechSynthesis.speak(utterance);
      }
    }

    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }

    document.addEventListener('DOMContentLoaded', function() {
      initAudio();
      initSpeechRecognition();
    });

    if ('speechSynthesis' in window) {
      speechSynthesis.onvoiceschanged = function() {
        console.log('Voices loaded for MathGenius IA');
      };
    }

    // ==================== LANGUAGE SCORING SYSTEM ====================
    // Sistema de Puntuaci√≥n de Idiomas para MathGenius
    class LanguageScorerMath {
      constructor() {
        this.currentLanguage = 'es';
        this.apiUrl = 'http://127.0.0.1:5000/api';
        this.scores = {
          grammar: 0,
          syntax: 0,
          vocabulary: 0,
          pronunciation: 0,
          overall: 0
        };
        this.initLanguageUI();
      }

      initLanguageUI() {
        // Agregar bot√≥n de cambio de idioma en la interfaz
        const header = document.querySelector('.header') || document.querySelector('.container');
        if (header) {
          const languageToggle = document.createElement('div');
          languageToggle.className = 'language-toggle-math';
          languageToggle.innerHTML = `
            <button id="langToggleMath" onclick="languageScorerMath.toggleLanguage()" 
                    style="position: fixed; top: 20px; right: 80px; z-index: 1000; 
                           background: rgba(139, 92, 246, 0.9); color: white; border: none; 
                           padding: 8px 12px; border-radius: 20px; font-size: 12px; 
                           cursor: pointer; backdrop-filter: blur(10px); 
                           box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
                           transition: all 0.3s ease;">
              ${this.currentLanguage === 'es' ? 'üá™üá∏ ES' : 'üá∫üá∏ EN'}
            </button>
          `;
          header.appendChild(languageToggle);
        }

        // Agregar panel de scoring
        this.createScoringPanel();
      }

      createScoringPanel() {
        const scoringPanel = document.createElement('div');
        scoringPanel.id = 'mathLanguageScoring';
        scoringPanel.style.cssText = `
          position: fixed; bottom: 20px; right: 20px; width: 280px; 
          background: rgba(255, 255, 255, 0.95); border-radius: 15px; 
          padding: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
          backdrop-filter: blur(10px); border: 1px solid rgba(139, 92, 246, 0.2);
          z-index: 1000; font-size: 12px; display: none;
        `;
        
        scoringPanel.innerHTML = `
          <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
            <h4 style="margin: 0; color: #8b5cf6; font-size: 14px; font-weight: 600;">
              üìä ${this.currentLanguage === 'es' ? 'Puntuaci√≥n de Idiomas' : 'Language Scoring'}
            </h4>
            <button onclick="languageScorerMath.togglePanel()" 
                    style="background: none; border: none; font-size: 16px; cursor: pointer;">√ó</button>
          </div>
          
          <div style="margin-bottom: 12px;">
            <label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">
              ${this.currentLanguage === 'es' ? 'Texto a analizar:' : 'Text to analyze:'}
            </label>
            <textarea id="mathTextAnalyze" placeholder="${this.currentLanguage === 'es' ? 'Escribe aqu√≠ para an√°lisis...' : 'Write here for analysis...'}"
                      style="width: 100%; height: 60px; border: 1px solid #e2e8f0; border-radius: 8px; 
                             padding: 8px; font-size: 11px; resize: none;"></textarea>
          </div>
          
          <div style="display: flex; gap: 8px; margin-bottom: 12px;">
            <button onclick="languageScorerMath.analyzeText()" 
                    style="flex: 1; background: #8b5cf6; color: white; border: none; 
                           padding: 8px; border-radius: 6px; font-size: 11px; cursor: pointer;">
              ${this.currentLanguage === 'es' ? 'üîç Analizar' : 'üîç Analyze'}
            </button>
            <button onclick="languageScorerMath.startVoiceAnalysis()" 
                    style="flex: 1; background: #10b981; color: white; border: none; 
                           padding: 8px; border-radius: 6px; font-size: 11px; cursor: pointer;">
              ${this.currentLanguage === 'es' ? 'üé§ Hablar' : 'üé§ Speak'}
            </button>
          </div>
          
          <div id="mathScoreDisplay" style="display: none;">
            <div style="margin-bottom: 8px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span style="font-size: 10px;">Gram√°tica:</span>
                <span id="mathGrammarScore" style="font-size: 10px; font-weight: 600;">0%</span>
              </div>
              <div style="background: #e2e8f0; height: 4px; border-radius: 2px;">
                <div id="mathGrammarBar" style="background: #8b5cf6; height: 100%; width: 0%; border-radius: 2px; transition: width 0.5s;"></div>
              </div>
            </div>
            
            <div style="margin-bottom: 8px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span style="font-size: 10px;">Sintaxis:</span>
                <span id="mathSyntaxScore" style="font-size: 10px; font-weight: 600;">0%</span>
              </div>
              <div style="background: #e2e8f0; height: 4px; border-radius: 2px;">
                <div id="mathSyntaxBar" style="background: #10b981; height: 100%; width: 0%; border-radius: 2px; transition: width 0.5s;"></div>
              </div>
            </div>
            
            <div style="margin-bottom: 8px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span style="font-size: 10px;">Vocabulario:</span>
                <span id="mathVocabScore" style="font-size: 10px; font-weight: 600;">0%</span>
              </div>
              <div style="background: #e2e8f0; height: 4px; border-radius: 2px;">
                <div id="mathVocabBar" style="background: #f59e0b; height: 100%; width: 0%; border-radius: 2px; transition: width 0.5s;"></div>
              </div>
            </div>
            
            <div style="margin-bottom: 12px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span style="font-size: 10px;">Pronunciaci√≥n:</span>
                <span id="mathPronScore" style="font-size: 10px; font-weight: 600;">0%</span>
              </div>
              <div style="background: #e2e8f0; height: 4px; border-radius: 2px;">
                <div id="mathPronBar" style="background: #ef4444; height: 100%; width: 0%; border-radius: 2px; transition: width 0.5s;"></div>
              </div>
            </div>
            
            <div style="text-align: center; margin-bottom: 10px;">
              <span style="font-size: 10px; color: #666;">Puntuaci√≥n General:</span>
              <div id="mathOverallScore" style="font-size: 16px; font-weight: 700; color: #8b5cf6;">0%</div>
            </div>
            
            <div id="mathAdvice" style="font-size: 10px; color: #666; line-height: 1.3; 
                                      background: #f8fafc; padding: 8px; border-radius: 6px; border-left: 3px solid #8b5cf6;">
            </div>
          </div>
        `;
        
        document.body.appendChild(scoringPanel);
        
        // Agregar bot√≥n para mostrar/ocultar panel
        const toggleButton = document.createElement('button');
        toggleButton.id = 'mathScoringToggle';
        toggleButton.innerHTML = 'üìä';
        toggleButton.style.cssText = `
          position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; 
          background: #8b5cf6; color: white; border: none; border-radius: 50%; 
          font-size: 20px; cursor: pointer; z-index: 999; 
          box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
          transition: all 0.3s ease;
        `;
        toggleButton.onclick = () => this.togglePanel();
        document.body.appendChild(toggleButton);
      }

      toggleLanguage() {
        this.currentLanguage = this.currentLanguage === 'es' ? 'en' : 'es';
        const button = document.getElementById('langToggleMath');
        if (button) {
          button.innerHTML = this.currentLanguage === 'es' ? 'üá™üá∏ ES' : 'üá∫üá∏ EN';
        }
        this.updateLanguageUI();
      }

      updateLanguageUI() {
        const panel = document.getElementById('mathLanguageScoring');
        if (panel) {
          // Actualizar textos del panel seg√∫n idioma
          const texts = this.currentLanguage === 'es' ? {
            title: 'üìä Puntuaci√≥n de Idiomas',
            textLabel: 'Texto a analizar:',
            placeholder: 'Escribe aqu√≠ para an√°lisis...',
            analyzeBtn: 'üîç Analizar',
            speakBtn: 'üé§ Hablar'
          } : {
            title: 'üìä Language Scoring',
            textLabel: 'Text to analyze:',
            placeholder: 'Write here for analysis...',
            analyzeBtn: 'üîç Analyze',
            speakBtn: 'üé§ Speak'
          };
          
          // Aqu√≠ actualizar√≠as los textos del panel
          console.log('Language updated to:', this.currentLanguage);
        }
      }

      togglePanel() {
        const panel = document.getElementById('mathLanguageScoring');
        const button = document.getElementById('mathScoringToggle');
        
        if (panel.style.display === 'none' || !panel.style.display) {
          panel.style.display = 'block';
          button.style.display = 'none';
        } else {
          panel.style.display = 'none';
          button.style.display = 'block';
        }
      }

      async analyzeText() {
        const textarea = document.getElementById('mathTextAnalyze');
        const text = textarea.value.trim();
        
        if (!text) {
          alert(this.currentLanguage === 'es' ? 'Por favor ingresa texto para analizar' : 'Please enter text to analyze');
          return;
        }

        try {
          // Mostrar indicador de carga
          const analyzeBtn = event.target;
          const originalText = analyzeBtn.innerHTML;
          analyzeBtn.innerHTML = this.currentLanguage === 'es' ? '‚è≥ Analizando...' : '‚è≥ Analyzing...';
          analyzeBtn.disabled = true;

          const response = await fetch(`${this.apiUrl}/analyze-language`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              text: text,
              language: this.currentLanguage
            })
          });

          if (!response.ok) {
            throw new Error('Error en la API');
          }

          const result = await response.json();
          this.displayScores(result.scores, result.advice);

        } catch (error) {
          console.error('Error analyzing text:', error);
          
          // Simular resultados para demo
          const mockScores = {
            grammar: Math.floor(Math.random() * 30) + 70,
            syntax: Math.floor(Math.random() * 30) + 70,
            vocabulary: Math.floor(Math.random() * 30) + 70,
            pronunciation: Math.floor(Math.random() * 30) + 70,
            overall: Math.floor(Math.random() * 20) + 75
          };
          
          const mockAdvice = this.currentLanguage === 'es' ? 
            ['Excelente uso del vocabulario matem√°tico', 'Considera mejorar la estructura de las oraciones', 'Tu pronunciaci√≥n es clara y precisa'] :
            ['Excellent use of mathematical vocabulary', 'Consider improving sentence structure', 'Your pronunciation is clear and precise'];
          
          this.displayScores(mockScores, mockAdvice);
        } finally {
          // Restaurar bot√≥n
          const analyzeBtn = document.querySelector('button[onclick="languageScorerMath.analyzeText()"]');
          if (analyzeBtn) {
            analyzeBtn.innerHTML = this.currentLanguage === 'es' ? 'üîç Analizar' : 'üîç Analyze';
            analyzeBtn.disabled = false;
          }
        }
      }

      displayScores(scores, advice) {
        this.scores = scores;
        
        // Mostrar panel de resultados
        document.getElementById('mathScoreDisplay').style.display = 'block';
        
        // Actualizar barras de progreso y valores
        setTimeout(() => {
          document.getElementById('mathGrammarScore').textContent = scores.grammar + '%';
          document.getElementById('mathGrammarBar').style.width = scores.grammar + '%';
          
          document.getElementById('mathSyntaxScore').textContent = scores.syntax + '%';
          document.getElementById('mathSyntaxBar').style.width = scores.syntax + '%';
          
          document.getElementById('mathVocabScore').textContent = scores.vocabulary + '%';
          document.getElementById('mathVocabBar').style.width = scores.vocabulary + '%';
          
          document.getElementById('mathPronScore').textContent = scores.pronunciation + '%';
          document.getElementById('mathPronBar').style.width = scores.pronunciation + '%';
          
          document.getElementById('mathOverallScore').textContent = scores.overall + '%';
          
          // Mostrar consejos
          const adviceEl = document.getElementById('mathAdvice');
          if (advice && advice.length > 0) {
            adviceEl.innerHTML = `<strong>${this.currentLanguage === 'es' ? 'Consejos:' : 'Advice:'}</strong><br>` + 
                               advice.slice(0, 2).map(tip => `‚Ä¢ ${tip}`).join('<br>');
          }
        }, 300);
      }

      startVoiceAnalysis() {
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
          alert(this.currentLanguage === 'es' ? 
                'Tu navegador no soporta reconocimiento de voz' : 
                'Your browser does not support voice recognition');
          return;
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        
        recognition.lang = this.currentLanguage === 'es' ? 'es-ES' : 'en-US';
        recognition.continuous = false;
        recognition.interimResults = false;

        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = this.currentLanguage === 'es' ? 'üé§ Escuchando...' : 'üé§ Listening...';
        button.disabled = true;
        button.style.background = '#ef4444';

        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          document.getElementById('mathTextAnalyze').value = transcript;
          
          // Auto-analizar el texto capturado
          this.analyzeText();
        };

        recognition.onerror = (event) => {
          console.error('Speech recognition error:', event.error);
          alert(this.currentLanguage === 'es' ? 
                'Error en el reconocimiento de voz' : 
                'Voice recognition error');
        };

        recognition.onend = () => {
          button.innerHTML = originalText;
          button.disabled = false;
          button.style.background = '#10b981';
        };

        recognition.start();
      }
    }

    // Inicializar el sistema de puntuaci√≥n de idiomas para MathGenius
    let languageScorerMath;
    document.addEventListener('DOMContentLoaded', function() {
      // Esperar un poco para que se cargue todo MathGenius
      setTimeout(() => {
        languageScorerMath = new LanguageScorerMath();
        console.log('üßÆüìä MathGenius Language Scoring System initialized');
      }, 2000);
    });
  </script>
</body>
</html>
